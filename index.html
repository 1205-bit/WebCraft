<!DOCTYPE HTML>
<html>
	<head>
		<title>WebCraft</title>
		
		<!-- Character encoding -->
		<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
		
		<!-- Stylesheet -->
		<link href="style/main.css" rel="stylesheet" type="text/css">
		
		<!-- Modules -->
		<script src="js/glMatrix-1.2.min.js" type="text/javascript"></script>
		<script src="js/blocks.js" type="text/javascript"></script>
		<script src="js/helpers.js" type="text/javascript"></script>
		<script src="js/world.js" type="text/javascript"></script>
		<script src="js/render.js" type="text/javascript"></script>
		<script src="js/physics.js" type="text/javascript"></script>
	</head>
	
	<body>
		<!-- Render surface -->
		<canvas id="renderSurface"></canvas>
		
		<!-- FPS display -->
		<div id="fpsContainer">
			<span id="fpsDisplay">FPS: -</span>
		</div>
		
		<!-- Initialisation code -->
		<script type="text/javascript">			
			// Create a new flat world
			var world = new World( 8, 8, 8 );
			world.createFlatWorld( 2 );
			
			// World modification test
			for ( var i = 2; i <= 4; i++ ) world.setBlock( 1, 1, i, BLOCK.DIRT );
			for ( var i = 2; i <= 4; i++ ) world.setBlock( 3, 1, i, BLOCK.DIRT );
			for ( var i = 2; i <= 4; i++ ) world.setBlock( 1, 3, i, BLOCK.DIRT );
			for ( var i = 2; i <= 4; i++ ) world.setBlock( 3, 3, i, BLOCK.DIRT );
			world.setBlock( 2, 1, 4, BLOCK.DIRT );
			world.setBlock( 1, 2, 4, BLOCK.DIRT );
			world.setBlock( 2, 3, 4, BLOCK.DIRT );
			world.setBlock( 3, 2, 4, BLOCK.DIRT );
			
			world.setBlock( 6, 6, 1, BLOCK.LAVA );
			world.setBlock( 5, 6, 1, BLOCK.AIR );
			world.setBlock( 4, 6, 1, BLOCK.AIR );
			world.setBlock( 3, 6, 1, BLOCK.AIR );
			world.setBlock( 2, 6, 1, BLOCK.AIR );
			world.setBlock( 2, 5, 1, BLOCK.AIR );
			world.setBlock( 2, 4, 1, BLOCK.AIR );
			world.setBlock( 2, 3, 1, BLOCK.AIR );
			world.setBlock( 2, 2, 1, BLOCK.AIR );
			world.setBlock( 3, 2, 1, BLOCK.AIR );
			world.setBlock( 4, 2, 1, BLOCK.AIR );
			world.setBlock( 5, 2, 1, BLOCK.AIR );
			world.setBlock( 6, 2, 1, BLOCK.AIR );
			
			world.setBlock( 6, 4, 7, BLOCK.SAND );
			
			// Set up renderer (and draw one test frame)
			var render = new Renderer( "renderSurface" );
			render.setWorld( world, 8 );
			render.setPerspective( 70, 0.1, 100 );
			render.buildChunks( 99 );
			
			// Create physics simulator
			var physics = new Physics();
			physics.setWorld( world );
			
			// Render loop
			var lastFPSRefresh = new Date().getSeconds();
			var frames = 0;
			
			setInterval( function()
			{
				var time = new Date().getTime() / 1000.0;
				var sec = new Date().getSeconds();
				
				// Simulate physics
				physics.simulate();
				
				// Build a chunk
				render.buildChunks( 1 );
				
				// Draw world
				render.setCamera( [ 4 + Math.cos( time ) * 8, 4 + Math.sin( time ) * 8, 7 ], [ 4, 4, 1 ] );
				render.draw();
				
				// Update FPS
				if ( sec != lastFPSRefresh ) {
					document.getElementById( "fpsDisplay" ).innerText = "FPS: " + frames;
					lastFPSRefresh = sec;
					frames = 0;
				} else {
					frames++;
				}
			}, 1 );
		</script>
	</body>
</html>